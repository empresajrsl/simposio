

<?php  

require_once('../PHPMailer_5.2.1/class.phpmailer.php');
// guarda o email do usuario 
$email = $_GET['email'] ;

// concatena uma string com o email
$string = sha1('sigma').$email.sha1('sigma');
// cria uma chave publica criptrografada
$cod = base64_encode($string);
$nome = 'SGAgro';

try {
    $mail = new PHPMailer(true); //New instance, with exceptions enabled
    
    $body = '<html>';
$body.= '<head>';
$body.=     '<meta charset="utf-8">';
$body.=     '<link type="text/css" rel="stylesheet" href="../css/bootstrap.min.css" ></link>';
$body.=     '<link type="text/css" rel="stylesheet" href="../css/style.css" ></link>';
$body.=    ' <script src="../js/jquery-2.1.1.min.js"></script>';
$body.=     '<script src="../js/bootstrap.min.js"></script><script src="../js/tooltip.js"></script>';
$body.=     '<script src="../plugin/jquery-validate/jquery.validate.min.js"></script>';
$body.=     '<title>Confirmação por E-mail</title>';
$body.=    ' <link rel="shortcut icon" href="../images/SGAGRO LOGO.ico" type="image/x-icon"/>';
$body.= '</head>';
$body.= '<body>';
$body.=     '<div class="container">';


$body.=         '<div class="jumbotron" style="background-image: url("../images/fundo.png"); background-size: cover;">';
$body.=            ' <div class="row" style="margin-left: -6.5%; margin-right: 6.5%">';
$body.=                 '<div class="col-md-12 col-xs-12 col-lg-12">';
$body.=                     '<div class="col-md-4 col-xs-4 col-lg-4">';
$body.=                        ' <img src="../images/SGAGRO LOGO.png" style="width: 40%; height: 15%;">';
$body.=                         '<img src="../images/unesp.jpg" style="width: 40%; height: 15%; margin-left: 5%;">';
$body.=                     '</div>';
$body.=                     '<div class="col-md-6 col-xs-6 col-lg-6">';
$body.=                         '<center><h1><i style="font-family: "Plantagenet Cherokee";"><b>Confirmação por E-mail</b></i></center></h1>';
$body.=                     '</div>';
$body.=                 '</div>';
$body.=             '</div>';
$body.=         '</div>';


$body.=         '<div class="jumbotron">';
$body.=             '<div>';

$body.=                 '<center>Seu cadastro está quase concluído, após clicar no link o acesso ao sistema será concedido a <?php echo "<u>".$email."</u>"; ?>';
$body.=                 ' Caso ocorra algum erro, sugerimos que entre em contato com os desenvolvedores do sistema em:</center>';
$body.=             '</div>';

$body.=             '</br>';

$body.=             '<center><b>sigmajr@gmail.com<b></center>';

$body.=             '<center class="col-md-12 col-xs-12 col-lg-12"><h3>Clique no link abaixo para confirmar seu cadastro.</h3></center>';

$body.=             '</br>';

$body.=             "<center><?php echo '<a href='../model/confirmacad.php?email='.$cod.'target='_blank' style='font-size: 20px;> Confirmar Cadastro </a>; ?></center>";
$body.=         '</div>';

$body.=     '</div>';
$body.= '</body>';
$body.= '</html>  ';     

    $mensagem = 'teste';
     
    $mail->IsSMTP(); //tell the class to use SMTP
    $mail->SMTPAuth = true; // enable SMTP authentication
    $mail->Port = 587; //SMTP porta (as mais utilizadas são '25' e '587'
    $mail->Host = "smtp.sgagro.org"; // SMTP servidor
    $mail->Username = "sigmajr@sgagro.org";  // SMTP  usuário
    $mail->Password = "empresajr1";  // SMTP senha
     
    
     
    $mail->AddReplyTo($email); //Responder para..
    $mail->From = 'sigmajr@sgagro.org'; //e-mail fornecido pelo cliente
    $mail->FromName   = $nome; //nome fornecido pelo cliente
     
    $to = $email; //Enviar para
    $mail->AddAddress($to);
    $mail->Subject  = "Confirmação do cadastro"; //Assunto
    $mail->WordWrap   = 80; // set word wrap
     
    $mail->MsgHTML($body);
     
    $mail->IsHTML(true); // send as HTML
     
    if($mail->Send()){
    echo 'Mensagem enviada com sucesso teste para  '.$email; 
    }else{
        echo 'erro ao enviar o email teste '.$mail->ErrorInfo;
    }

} catch (phpmailerException $e) {
echo $e->errorMessage(); //retorno devolvido para o ajax caso erro
}



?>

